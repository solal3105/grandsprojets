:root {
    --green: #16a34a; --green-700:#047857; --green-800:#065f46; --bg:#f9fafb; --card:#ffffff;
    --muted:#6b7280; --ring: rgba(22,163,74,.25);
  }
  /* Thème sombre (hérité du site via localStorage 'theme' = 'dark') */
  :root.dark {
    --bg: #0b1220;        /* fond global */
    --card: #0f172a;      /* cartes */
    --muted: #94a3b8;     /* texte secondaire */
    /* on garde les verts tels quels pour la marque */
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color:#111827; }
  .dark body { color:#e5e7eb; }
  .container { max-width: 980px; margin: 24px auto; padding: 0 16px; }
  .topbar { display:flex; align-items:center; gap:12px; margin-bottom: 16px; }
  .topbar a { color: var(--green-800); text-decoration:none; font-weight:600; }
  .hero { background: linear-gradient(180deg,#ecfdf5,#f0fdf4); border:1px solid var(--green); border-radius: 16px; padding: 18px; box-shadow: 0 3px 10px rgba(0,128,0,.08); position:relative; overflow:hidden; }
  .dark .hero { background: linear-gradient(180deg,#052e1a,#073321); border-color:#16a34a; box-shadow: 0 4px 16px rgba(0,0,0,.35); }
  .hero::after { content: ""; position:absolute; inset:-2px; border-radius:18px; border:2px solid var(--ring); pointer-events:none; animation: pulse 1600ms ease-out infinite; }
  @keyframes pulse { 0% { opacity:.55 } 60% { opacity:.15 } 100% { opacity:.35 } }
  .hero h1 { margin: 0 0 6px; font-size: 22px; color: var(--green-800); }
  .hero p { margin: 0; color: #064e3b; }
  .dark .hero h1 { color:#a7f3d0; }
  .dark .hero p { color:#a7f3d0; }

  .grid { display:grid; grid-template-columns: 1.1fr .9fr; gap: 16px; margin-top: 16px; }
  .grid.onecol { grid-template-columns: 1fr; }
  @media (max-width: 840px) { .grid { grid-template-columns: 1fr; } }

  .card { background: var(--card); border:1px solid #e5e7eb; border-radius: 14px; padding: 14px; box-shadow: 0 2px 10px rgba(17,24,39,.04); }
  .dark .card { border-color:#334155; box-shadow: 0 2px 12px rgba(0,0,0,.35); }
  .card h2 { margin: 6px 0 10px; font-size: 18px; color: #1f2937; }
  .dark .card h2 { color:#e5e7eb; }
  .hint { color: var(--muted); font-size: 13px; }
  .row { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }

  .btn { display:inline-flex; align-items:center; gap:8px; background: var(--green); color:#fff; padding:10px 14px; border-radius:10px; text-decoration:none; font-weight:600; border:0; cursor:pointer; box-shadow: 0 2px 8px rgba(22,163,74,.25); }
  .btn.secondary { background:#e5e7eb; color:#111827; box-shadow:none; }
  .dark .btn.secondary { background:#1f2937; color:#e5e7eb; border:1px solid #334155; }
  .btn:hover { filter: brightness(1.05); }
  .dark .btn:hover { filter: brightness(1.1); }

  /* Logo: normal en clair, blanc en sombre */
  .topbar img { filter: none; }
  .dark .topbar img { filter: brightness(0) invert(1); }
  .btn:focus-visible { outline: 3px solid var(--ring); outline-offset: 2px; }
  .dark .btn { box-shadow: 0 2px 12px rgba(0,0,0,.35); background:#16a34a; color:#ecfdf5; }

  .input, textarea { width: 100%; border:1px solid #d1d5db; border-radius:10px; padding:10px 12px; font: inherit; }
  .dark .input, .dark textarea { background:#0b1220; color:#e5e7eb; border-color:#334155; }
  .input::placeholder, textarea::placeholder { color:#9ca3af; }
  .dark .input::placeholder, .dark textarea::placeholder { color:#94a3b8; }
  textarea { min-height: 140px; resize: vertical; }
  .pill { display:inline-flex; align-items:center; gap:6px; background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; padding:6px 10px; border-radius:999px; font-size:12px; }
  .dark .pill { background:#052e1a; color:#a7f3d0; border-color:#1e3a2a; }

  .dropzone { border:2px dashed #a7f3d0; background:#f0fdf4; border-radius:12px; padding:16px; text-align:center; color:#065f46; cursor:pointer; }
  .dropzone.dragover { background:#ecfdf5; border-color: var(--green); }
  .dropzone:focus-visible { outline: 3px solid var(--ring); outline-offset: 2px; }
  .dark .dropzone { background:#052e1a; border-color:#1e3a2a; color:#a7f3d0; }

  ul.clean { list-style:none; padding:0; margin:8px 0 0; }
  ul.clean li { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:6px 8px; border:1px solid #eef2f7; border-radius:10px; }
  .dark ul.clean li { border-color:#334155; }
  ul.clean li .name { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  /* Pas de largeur fixe pour PDF/URL: autoriser le retour à la ligne */
  #pdf-list .name, #url-list .name { white-space: normal; overflow: visible; text-overflow: clip; }
  /* Liens de la liste URL: garder la même couleur en visited */
  #url-list a.name, #url-list a.name:visited { color: inherit; }
  .small { font-size: 12px; color: var(--muted); }

  .result-placeholder { border:1px dashed #d1d5db; border-radius:12px; padding:16px; color:#6b7280; background:#fafafa; }
  .dark .result-placeholder { border-color:#334155; background:#0b1220; color:#94a3b8; }

  /* S'assurer que les éléments [hidden] sont bien cachés dans tous les navigateurs */
  [hidden] { display: none !important; }

  /* Modale résultats */
  .modal-overlay { position: fixed; inset: 0; background: rgba(17,24,39,.5); display: flex; align-items: center; justify-content: center; padding: 16px; z-index: 1000; }
  .modal-overlay { backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }
  .modal { width: min(920px, 100%); max-height: 85vh; background: #fff; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.25); overflow: hidden; display:flex; flex-direction:column; }
  .dark .modal { background:#0f172a; }
  .dark .modal h2 { color:#e5e7eb; }
  .modal-header { display:flex; align-items:center; justify-content: space-between; gap: 8px; padding: 12px 14px; border-bottom: 1px solid #eef2f7; background: #f9fafb; }
  .dark .modal-header { background:#0b1220; border-color:#334155; }
  .dark .modal-header h2 { color:#e5e7eb !important; }
  .modal-body { padding: 12px 14px; overflow: auto; text-align:left; }
  .result-item { display:flex; flex-direction:column; gap:6px; padding:14px; border:1px solid #eef2f7; border-radius:12px; margin-bottom:10px; background:#fff; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
  .dark .result-item { background:#0f172a; border-color:#334155; box-shadow: 0 1px 2px rgba(0,0,0,.35); }
  .result-item .title { font-weight:700; color:#111827; text-decoration:none; line-height:1.3; }
  .result-item .title:visited { color:#111827; }
  .result-item .title:hover { text-decoration:underline; }
  .result-item .meta { display:flex; align-items:center; gap:8px; color:#6b7280; font-size:12px; }
  .result-item .meta img { width:16px; height:16px; border-radius:4px; }
  .result-item .url { display:none; }
  .result-item .snippet { font-size:13px; color:#4b5563; }
  .dark .result-item .meta { color:#94a3b8; }
  .dark .result-item .snippet { color:#cbd5e1; }
  .dark .result-item .title { color:#e5e7eb; }
  .dark .result-item .title:visited { color:#e5e7eb; }
  .result-actions { display:flex; gap:8px; margin-top:6px; align-items:center; }
  .btn-icon { display:inline-flex; align-items:center; justify-content:center; gap:6px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; color:#374151; cursor:pointer; font-size:13px; }
  .btn-icon:hover { background:#f9fafb; }
  .btn-icon[aria-pressed="true"] { border-color:#d1fae5; background:#ecfdf5; color:#065f46; }
  .btn-icon[data-vote="down"][aria-pressed="true"] { border-color:#fee2e2; background:#fef2f2; color:#991b1b; }
  .dark .btn-icon { background:#0f172a; color:#e5e7eb; border-color:#334155; }
  .dark .btn-icon:hover { background:#111827; }
  /* Effets de "mini-collapse" (toujours visible et réversible) */
  .result-item.collapse-up { background: rgba(16,185,129,0.12); border-color:#d1fae5; }
  .dark .result-item.collapse-up { background: rgba(16,185,129,0.18); border-color:#1e3a2a; }
  .result-item.collapse-down { background: rgba(239,68,68,0.10); border-color:#fee2e2; }
  .dark .result-item.collapse-down { background: rgba(239,68,68,0.16); border-color:#7f1d1d; }
  .result-item.compact { padding:8px; gap:4px; opacity:0.95; transition: all .25s ease; }
  .result-item.compact .snippet { display:none; }
  /* Carte Recherche Google (clair/sombre) */
  .gsearch-card { background:linear-gradient(180deg,#fbfefc,#f7fdf9); border:1px solid #e5f6ea; border-radius:12px; padding:12px; }
  .dark .gsearch-card { background:linear-gradient(180deg,#0b1220,#0f172a); border-color:#334155; }
  .gsearch-title { font-weight:600; color:#065f46; }
  .dark .gsearch-title { color:#a7f3d0; }
  /* Barre de progression */
  .progress { position:relative; height:10px; background:#f3f4f6; border-radius:999px; margin:6px 0 12px; }
  .progress-bar { position:absolute; left:0; top:0; bottom:0; width:0%; background:#10b981; border-radius:999px; transition:width .3s ease; }
  .progress-label { display:block; font-size:12px; color:#6b7280; margin-top:6px; }
  .dark .progress { background:#334155; }
  .dark .progress-label { color:#94a3b8; }
  .spinner { display:inline-block; width:18px; height:18px; border:2px solid #d1d5db; border-top-color:#16a34a; border-radius:50%; animation: spin .9s linear infinite; vertical-align:middle; }
  @keyframes spin { to { transform: rotate(360deg); } }
  /* Erreur modale */
  .alert-error { background:#fef2f2; color:#991b1b; border:1px solid #fee2e2; padding:8px 10px; border-radius:8px; font-size:13px; margin:0 0 10px; }
  .dark .alert-error { background:#2a0f13; color:#fecaca; border-color:#7f1d1d; }
  /* Affichage des résultats sur la page */
  #gresults { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:12px; padding-left:0; max-height: 360px; overflow: auto; }
  /* Aperçu Markdown */
  .md-preview { border:1px solid #e5e7eb; border-radius:8px; padding:12px; background:#fafafa; font-size:14px; line-height:1.55; }
  .dark .md-preview { border-color:#334155; background:#0b1220; color:#e5e7eb; }
  .md-preview h1, .md-preview h2, .md-preview h3 { margin-top: 1em; }
  .md-preview pre { background:#111827; color:#f9fafb; padding:10px; border-radius:8px; overflow:auto; }
  .md-preview code { background:#f3f4f6; padding:2px 4px; border-radius:4px; }
  .dark .md-preview code { background:#111827; color:#e5e7eb; }
  /* Modale de progression */
  .pm-status { display:inline-flex; align-items:center; gap:6px; font-size:12px; color:#6b7280; }
  .pm-status .dot { width:8px; height:8px; border-radius:999px; background:#9ca3af; display:inline-block; }
  .dark .pm-status { color:#94a3b8; }
  .dark .pm-status .dot { background:#64748b; }
  .pm-item { display:flex; flex-direction:column; gap:6px; padding:10px; border:1px solid #eef2f7; border-radius:12px; margin-bottom:8px; background:#fff; }
  .dark .pm-item { background:#0f172a; border-color:#334155; color:#e5e7eb; }
  .pm-item .meta { display:flex; align-items:center; gap:8px; color:#6b7280; font-size:12px; }
  .dark .pm-item .meta { color:#94a3b8; }
  .pm-item .meta img { width:16px; height:16px; border-radius:4px; }
  .pm-item.done { border-color:#d1fae5; background:#ecfdf5; }
  .dark .pm-item.done { background:#052e1a; border-color:#1e3a2a; }
  .pm-item.done .pm-title { color:#065f46; }
  .dark .pm-title { color:#e5e7eb; }
  .pm-title { font-weight:600; color:#111827; }
  .pm-badge { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; font-size:11px; border:1px solid #e5e7eb; color:#374151; background:#f9fafb; }
  .pm-check { color:#10b981; font-weight:700; }

  /* Effet d'attente dans les champs (shimmer) */
  .shimmer {
    position: relative;
    /* Dégradé multicolore pastel sur le fond (très léger) */
    background-image: linear-gradient(90deg,
      rgba(124, 58, 237, 0.06) 0%,   /* violet pâle */
      rgba(219, 39, 119, 0.06) 20%,  /* rose pâle */
      rgba(245, 158, 11, 0.06) 40%,  /* orange pâle */
      rgba(16, 185, 129, 0.06) 60%,  /* vert pâle */
      rgba(59, 130, 246, 0.06) 80%,  /* bleu pâle */
      rgba(124, 58, 237, 0.06) 100%  /* violet boucle */
    );
    background-size: 300% 100%;
    background-position: 200% 0;
    animation: shimmerMove 1.6s linear infinite;
    color: transparent !important;
    caret-color: transparent !important;
    text-shadow: none !important;
    pointer-events: none;
  }
  @keyframes shimmerMove { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
  /* Booster la visibilité du shimmer en dark mode */
  .dark .shimmer {
    background-image: linear-gradient(90deg,
      rgba(124, 58, 237, 0.14) 0%,
      rgba(219, 39, 119, 0.14) 20%,
      rgba(245, 158, 11, 0.14) 40%,
      rgba(16, 185, 129, 0.14) 60%,
      rgba(59, 130, 246, 0.14) 80%,
      rgba(124, 58, 237, 0.14) 100%
    );
  }

  /* Effet pop-in quand le texte est prêt */
  .pop-in { animation: popIn .28s ease-out; }
  @keyframes popIn { 0% { transform: scale(.98); box-shadow: 0 0 0 rgba(0,0,0,0); }
                    60% { transform: scale(1.01); box-shadow: 0 6px 20px rgba(22,163,74,.15); }
                    100% { transform: scale(1); box-shadow: 0 0 0 rgba(0,0,0,0); } }