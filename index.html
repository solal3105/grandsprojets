<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Carte des grands projets d‚Äôurbanisme et de mobilit√© de la M√©tropole de Lyon: tram, projets urbains, travaux, voies lyonnaises... Dossiers, concertations et liens officiels.">
  <link rel="icon" type="image/png" href="/img/logomin.png" sizes="32x32">
  <title>Grands Projets de Lyon ‚Äì Urbanisme et Mobilit√©</title>
  <link rel="canonical" href="https://grandsprojets.com/">
  <meta property="og:site_name" content="Grands Projets de Lyon">
  <meta property="og:locale" content="fr_FR">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Grands Projets de Lyon ‚Äì Urbanisme et Mobilit√©">
  <meta property="og:description" content="Carte des grands projets d‚Äôurbanisme et de mobilit√© de la M√©tropole de Lyon: tram, projets urbains, travaux, voies lyonnaises... Dossiers, concertations et liens officiels.">
  <meta property="og:url" content="https://grandsprojets.com/">
  <meta property="og:image" content="https://grandsprojets.com/img/cover/meta.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Grands Projets de Lyon ‚Äì Urbanisme et Mobilit√©">
  <meta name="twitter:description" content="Carte des grands projets d‚Äôurbanisme et de mobilit√© de la M√©tropole de Lyon: tram, projets urbains, travaux, voies lyonnaises... Dossiers, concertations et liens officiels.">
  <meta name="twitter:image" content="https://grandsprojets.com/img/cover/meta.png">
  <script type="application/ld+json" id="site-jsonld">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Grands Projets de Lyon",
    "url": "https://grandsprojets.com/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://grandsprojets.com/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <script>
    (function() {
      try {
        var theme = (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
      } catch (e) {}
    })();
  </script>
  <link rel="stylesheet" href="style.css" />
  <!-- Chargement de Leaflet depuis des fichiers locaux -->
  <link rel="stylesheet" href="vendor/leaflet/leaflet.css">
  <!-- Geoman removed: manual drawing only -->
  <link rel="stylesheet" href="ficheprojet.css">
  <!-- Font Awesome via cdnjs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8LGDVJXTPK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());

    gtag('config', 'G-8LGDVJXTPK');
  </script>
</head>
<body>
  <!-- Standalone fixed logo for small screens -->
  <a class="mobile-fixed-logo" href="index.html" aria-label="Accueil">
    <img src="img/logo.svg" alt="Grands Projets de Lyon" />
  </a>
  <div id="container">
    <!-- Carte Leaflet -->
    <div id="map"></div>

    <!-- Barre de navigation -->
    <div id="left-nav">
      <div class="logo">
          <img src="img/logo.svg" alt="GrandsProjet.fr" />
        </div>
      <!-- Cat√©gories dynamiques g√©n√©r√©es depuis category_icons -->
      <div id="dynamic-categories"></div>
      <!-- Bouton contribution -->
      <button class="nav-category" id="nav-contribute" aria-label="Proposer une contribution" title="Proposer une contribution">
        <i class="fa-solid fa-plus" aria-hidden="true"></i>
        <span class="label">contribuer</span>
      </button>
      <!-- Sous-menus dynamiques -->
      <div id="dynamic-submenus"></div>
  </div>

  <!-- Contribution modal -->
  <div id="contrib-overlay" class="gp-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="contrib-title" aria-hidden="true" style="display:none">
    <div class="gp-modal" role="document">
      <div class="gp-modal-header">
        <button id="contrib-back" class="gp-btn gp-btn--secondary" style="display:none; margin-right:8px;">
          <i class="fa fa-arrow-left" aria-hidden="true"></i>
          <span>Retour</span>
        </button>
        <div class="gp-modal-title" id="contrib-title">Proposer une contribution</div>
        <button class="gp-modal-close" id="contrib-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="gp-modal-body">
        <!-- Landing: choix initial (affich√© au premier lancement) -->
        <section id="contrib-landing" class="contrib-landing" role="region" aria-label="Choisir une action" hidden>
          <h3 class="landing-title">Que voulez-vous faire&nbsp;?</h3>
          <div class="landing-cards" role="list">
            <button class="choice-card" role="listitem" id="landing-create" data-target="create" aria-describedby="landing-create-desc">
              <span class="card-icon" aria-hidden="true"><i class="fa-solid fa-plus-circle"></i></span>
              <span class="card-title">Cr√©er une contribution</span>
              <span class="card-desc" id="landing-create-desc">Ajoutez un nouveau projet avec son trac√© et ses informations.</span>
            </button>
            <button class="choice-card" role="listitem" id="landing-edit" data-target="list" aria-describedby="landing-edit-desc">
              <span class="card-icon" aria-hidden="true"><i class="fa-solid fa-pen-to-square"></i></span>
              <span class="card-title">Modifier mes contributions</span>
              <span class="card-desc" id="landing-edit-desc">Consultez et mettez √† jour vos contributions existantes.</span>
            </button>
            <button class="choice-card" role="listitem" id="landing-categories" data-target="categories" aria-describedby="landing-categories-desc">
              <span class="card-icon" aria-hidden="true"><i class="fa-solid fa-tags"></i></span>
              <span class="card-title">G√©rer les cat√©gories</span>
              <span class="card-desc" id="landing-categories-desc">Cr√©ez ou modifiez les cat√©gories et leurs ic√¥nes.</span>
            </button>
          </div>
        </section>
        <!-- Bouton Retour vers la page d‚Äôaccueil de la modale -->
        <div class="contrib-toolbar" aria-hidden="false">
        </div>

        

        <!-- Panel: Cr√©ation / √âdition -->
        <section id="contrib-panel-create" role="tabpanel" aria-label="Cr√©er">
        <!-- Stepper navigation -->
        <div class="contrib-stepper" id="contrib-stepper" role="tablist" aria-label="√âtapes de contribution">
          <button class="contrib-step" id="contrib-step-1-tab" role="tab" aria-selected="true" tabindex="0">1. Infos</button>
          <button class="contrib-step" id="contrib-step-2-tab" role="tab" aria-selected="false" tabindex="-1">2. Trac√©</button>
          <button class="contrib-step" id="contrib-step-3-tab" role="tab" aria-selected="false" tabindex="-1">3. Options</button>
          <button class="contrib-step" id="contrib-step-4-tab" role="tab" aria-selected="false" tabindex="-1">4. Liens</button>
        </div>
        <!-- Assistant r√©dacteur (Carte verte anim√©e, √©tape 3 uniquement) -->
        <div id="assistant-writer-card" class="contrib-step-3" role="region" aria-label="Assistant r√©dacteur"
             style="margin:12px 0 14px; border:1px solid #16a34a; border-radius:14px; padding:14px; background:linear-gradient(180deg,#ecfdf5,#f0fdf4); box-shadow:0 2px 8px rgba(0,128,0,.08); position:relative; overflow:hidden;">
          <!-- overlay cliquable sur toute la carte -->
          <a href="/assistant-ia/" target="_blank" rel="noopener" aria-label="Ouvrir l‚Äôassistant IA"
             style="position:absolute; inset:0; z-index:1; opacity:0;">
          </a>
          <div style="display:flex; gap:12px; align-items:center; position:relative; z-index:2;">
            <div class="sparkle" aria-hidden="true" style="font-size:28px; line-height:1;">‚ú®</div>
            <div style="flex:1 1 auto; min-width:0;">
              <h3 class="title" style="margin:0; color:#065f46; font-size:18px;">
                <span class="shimmer">R√©diger avec l‚Äôassistant</span>
              </h3>
              <div class="subtitle" style="margin:2px 0 8px; color:#064e3b; font-size:14px;">Premier jet en 1 minute</div>
              <div class="chips" aria-label="L‚Äôassistant vous aide pour">
                <span>Markdown</span>
                <span>M√©ta</span>
                <span>Description</span>
              </div>
            </div>
            <a id="contrib-assistant-link" href="/assistant-ia/" target="_blank" rel="noopener"
               style="display:inline-block; background:#16a34a; color:#fff; padding:10px 14px; border-radius:10px; text-decoration:none; font-weight:600; white-space:nowrap; position:relative; z-index:3;">
              Ouvrir
            </a>
          </div>
        </div>
        <!-- Styles sp√©cifiques √† la carte assistant (scop√©s) -->
        <style>
          /* Pop-in √† l‚Äôapparition en √©tape 3 */
          #assistant-writer-card { animation: agp-pop 480ms cubic-bezier(.2,.8,.2,1) both; }
          @keyframes agp-pop { from { transform: translateY(-6px) scale(.98); opacity:.0; } to { transform: translateY(0) scale(1); opacity:1; } }

          /* Halo pulsant vert (accent non intrusif) */
          #assistant-writer-card::after {
            content:""; position:absolute; inset:-2px; border-radius:16px;
            border:2px solid rgba(22,163,74,.35); pointer-events:none; filter:blur(.3px);
            animation: agp-pulse 1600ms ease-out infinite;
          }
          @keyframes agp-pulse { 0% { opacity:.55; } 60% { opacity:.15; } 100% { opacity:.35; } }

          /* L‚Äôemoji flotte l√©g√®rement */
          #assistant-writer-card .sparkle { animation: agp-float 2800ms ease-in-out infinite; }
          @keyframes agp-float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

          /* Titre scintillant discret */
          #assistant-writer-card .shimmer {
            background: linear-gradient(90deg, #065f46 0%, #10b981 50%, #065f46 100%);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            background-size: 200% 100%; animation: agp-shimmer 2200ms linear infinite;
          }
          @keyframes agp-shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

          /* Petites pastilles explicatives */
          #assistant-writer-card .chips { display:flex; gap:6px; flex-wrap:wrap; }
          #assistant-writer-card .chips span {
            background:#e8f5e9; color:#065f46; border:1px solid #a7f3d0;
            border-radius:999px; padding:4px 8px; font-size:12px; line-height:1;
            animation: agp-chip-in 420ms cubic-bezier(.2,.8,.2,1) both;
          }
          #assistant-writer-card .chips span:nth-child(2) { animation-delay: 60ms; }
          #assistant-writer-card .chips span:nth-child(3) { animation-delay: 120ms; }
          @keyframes agp-chip-in { from { transform: translateY(4px); opacity:0; } to { transform: translateY(0); opacity:1; } }
        </style>

        <form id="contrib-form" class="contrib-form">
          <div class="form-row contrib-step-1">
            <label for="contrib-project-name">Nom du projet</label>
            <input type="text" id="contrib-project-name" name="project_name" required placeholder="Ex: Tram T10 ‚Äì Phase 2" />
          </div>

          <div class="form-row contrib-step-1">
            <label for="contrib-category">Cat√©gorie</label>
            <select id="contrib-category" name="category_layer" required>
              <option value="mobilite">Mobilit√©</option>
              <option value="urbanisme">Urbanisme</option>
              <option value="velo">V√©lo</option>
            </select>
          </div>

          <div class="form-row contrib-step-1">
            <label for="contrib-city">Code collectivit√©</label>
            <select id="contrib-city" name="ville">
              <option value="">Aucun</option>
              <!-- Options peupl√©es dynamiquement depuis la base -->
            </select>
          </div>

          <div class="contrib-step-2" id="contrib-geom-mode">
            <!-- Radios cach√©s pour l‚Äôaccessibilit√© et la soumission -->
            <div class="visually-hidden" aria-hidden="true">
              <input type="radio" id="geom-mode-file" name="contrib-geom-mode" value="file" checked>
              <input type="radio" id="geom-mode-draw" name="contrib-geom-mode" value="draw">
            </div>
            <div class="geom-mode-cards" role="list">
              <button type="button" class="geom-card is-active" id="geom-card-file" role="listitem" aria-pressed="true" aria-controls="contrib-file-row" data-mode="file">
                <span class="geom-icon" aria-hidden="true"><i class="fa-solid fa-file-arrow-up"></i></span>
                <span class="geom-title">Importer un fichier GeoJSON</span>
                <span class="geom-desc">D√©posez votre trac√© au format GeoJSON (.geojson, .json)</span>
              </button>
              <button type="button" class="geom-card" id="geom-card-draw" role="listitem" aria-pressed="false" aria-controls="contrib-draw-panel" data-mode="draw">
                <span class="geom-icon" aria-hidden="true"><i class="fa-solid fa-pen-ruler"></i></span>
                <span class="geom-title">Dessiner sur la carte</span>
                <span class="geom-desc">Tracez votre itin√©raire ou zone directement sur la carte</span>
              </button>
            </div>
          </div>

          <div class="form-row contrib-step-2" id="contrib-file-row">
            <input type="file" id="contrib-geojson" name="geojson_file" accept=".geojson,application/geo+json,application/json" required style="display:none;" />
            <div id="contrib-dropzone" class="file-dropzone" role="button" tabindex="0" aria-label="D√©poser un fichier GeoJSON ou cliquer pour choisir">
              <div class="dz-text">
                <div class="dz-title">D√©posez votre fichier GeoJSON</div>
                <div class="dz-sub">‚Ä¶ ou cliquez pour choisir un fichier</div>
              </div>
              <div class="dz-selected">
                <span class="dz-icon" aria-hidden="true"><i class="fa-regular fa-file-lines"></i></span>
                <span id="contrib-dz-filename" class="dz-filename"></span>
              </div>
            </div>
            
          </div>

          <div class="form-row contrib-step-2" id="contrib-draw-panel" style="display:none;">
            <div id="contrib-draw-map" style="height:320px; border-radius:8px; overflow:hidden;"></div>
          </div>

          <div class="form-row contrib-step-3">
            <label for="contrib-cover">Cover (optionnelle)</label>
            <input type="file" id="contrib-cover" name="cover_file" accept="image/png,image/jpeg,image/webp" />
            <small>Image .png, .jpg ou .webp. Elle sera stock√©e et son URL journalis√©e.</small>
            <div id="contrib-cover-preview" style="margin-top:6px"></div>
          </div>

          <div class="form-row contrib-step-3">
            <label for="contrib-meta">Meta</label>
            <textarea id="contrib-meta" name="meta" rows="3" maxlength="200" placeholder="M√©ta information (ex: tag, note, source)" required></textarea>
            <small>Texte utilis√© pour le SEO (extrait dans les r√©sultats Google). Visez une phrase claire et percutante (~160 caract√®res).</small>
          </div>

          <div class="form-row contrib-step-3">
            <label for="contrib-description">Description</label>
            <textarea id="contrib-description" name="description" rows="3" placeholder="Courte description du projet (ex: 1-3 phrases)" required></textarea>
            <small>Donnez l‚Äôessentiel du projet en 2‚Äì3 phrases, de fa√ßon engageante pour donner envie d‚Äôen savoir plus.</small>
          </div>

          <div class="form-row contrib-step-3">
            <label for="contrib-markdown">Contenu Markdown (optionnel)</label>
            <textarea id="contrib-markdown" name="markdown" rows="8" placeholder="# Titre\n\nD√©crivez le projet, ajoutez des liens, etc."></textarea>
            <small>
              R√©digez le contenu de l‚Äôarticle en <strong>Markdown</strong> (titres, images, liens, tableaux‚Ä¶).
              Astuce&nbsp;: utilisez un √©diteur d√©di√© comme
              <a href="https://dillinger.io/" target="_blank" rel="noopener">Dillinger</a>
              ou <a href="https://stackedit.io/app" target="_blank" rel="noopener">StackEdit</a> pour vous aider.
              Le contenu sera stock√© en Markdown et li√© √† votre contribution.
            </small>
          </div>

          <div class="form-row contrib-step-4 official-link-card">
            <label for="contrib-official-url">üîó Lien officiel du projet (optionnel)</label>
            <input type="url" id="contrib-official-url" name="official_url" placeholder="https://..." />
            <small>Un unique lien officiel vers la page du projet (quelle que soit la cat√©gorie).</small>
          </div>

          <div class="contrib-step-4" id="contrib-docs">
            <div class="contrib-docs-title">üìÑ Documents li√©s</div>
            <div id="contrib-existing-docs" class="contrib-existing-docs" aria-live="polite" style="margin-bottom:8px;"></div>
          </div>

          <div class="form-actions" style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <button type="button" id="contrib-prev" class="gp-btn gp-btn--secondary">
              <span>Pr√©c√©dent</span>
            </button>
            <button type="button" id="contrib-next" class="gp-btn">
              <span>Suivant</span>
            </button>
            <button type="submit" id="contrib-submit" class="gp-btn" style="display:none;">
              <i class="fa fa-paper-plane" aria-hidden="true"></i>
              <span>Envoyer</span>
            </button>
            <button type="button" id="contrib-cancel-edit" class="gp-btn gp-btn--secondary" style="display:none">
              <span>Annuler la modification</span>
            </button>
            <button type="button" id="contrib-delete" class="gp-btn gp-btn--secondary" title="Supprimer la contribution"
                    style="display:none; color:#fff; background:#c62828; border-color:#b71c1c;">
              <i class="fa fa-trash" aria-hidden="true"></i>
              <span>Supprimer</span>
            </button>
          </div>
        </form>
        </section>

        <!-- Panel: Liste des contributions -->
        <section id="contrib-panel-list" role="tabpanel" aria-labelledby="contrib-tab-list" hidden>
          <div class="form-row" style="display:flex; gap:8px; align-items:flex-end; flex-wrap:wrap;">
            <div style="flex:1 1 220px;">
              <label for="contrib-search">Rechercher</label>
              <div class="contrib-searchbar">
                <i class="fa fa-search" aria-hidden="true"></i>
                <input type="text" id="contrib-search" placeholder="Nom du projet, description‚Ä¶" />
              </div>
            </div>
            <div style="flex:0 0 200px;">
              <label for="contrib-filter-category">Cat√©gorie</label>
              <select id="contrib-filter-category">
                <option value="">Toutes</option>
                <option value="mobilite">Mobilit√©</option>
                <option value="urbanisme">Urbanisme</option>
                <option value="velo">V√©lo</option>
              </select>
            </div>
            <div style="flex:0 0 200px;">
              <label for="contrib-sort">Tri</label>
              <select id="contrib-sort">
                <option value="updated_at:desc">Plus r√©centes</option>
                <option value="updated_at:asc">Plus anciennes</option>
              </select>
            </div>
            <div style="flex:0 0 auto; align-self:center;">
              <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                <input type="checkbox" id="contrib-mine-only" />
                <span>Mes contributions</span>
              </label>
            </div>
          </div>
          <div id="contrib-list" class="contrib-list" role="list" style="max-height:340px; overflow:auto;">
            <!-- Items inject√©s en JS -->
            <div id="contrib-list-sentinel" style="height:1px;"></div>
          </div>
          <div id="contrib-list-status" role="status" aria-live="polite" style="margin-top:6px; font-size:0.9em; opacity:0.8;"></div>
        </section>

        <!-- Panel: Gestion des cat√©gories -->
        <section id="contrib-panel-categories" role="tabpanel" aria-label="G√©rer les cat√©gories" hidden>
          <div id="category-ville-selector-container" style="margin-bottom:20px; padding:16px; border:1px solid #ddd; border-radius:8px; background:#f9f9f9;">
            <label for="category-ville-selector" style="display:block; font-weight:600; margin-bottom:8px;">
              <i class="fa-solid fa-city"></i> S√©lectionner une ville
            </label>
            <select id="category-ville-selector" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:1em;">
              <option value="">-- Choisir une ville --</option>
              <!-- Options peupl√©es dynamiquement -->
            </select>
          </div>
          
          <div id="categories-content" style="display:none;">
            <div style="margin-bottom:16px;">
              <button id="category-add-btn" class="gp-btn gp-btn--primary" type="button">
                <i class="fa-solid fa-plus"></i> Nouvelle cat√©gorie
              </button>
            </div>
            <div id="categories-list" class="categories-list"></div>
          </div>
          
          <!-- Formulaire de cr√©ation/√©dition de cat√©gorie -->
          <div id="category-form-container" style="display:none; margin-top:20px; padding:16px; border:1px solid #ddd; border-radius:8px; background:#f9f9f9;">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
              <button type="button" id="category-form-back" class="gp-btn gp-btn--secondary" style="display:none;">
                <i class="fa-solid fa-arrow-left"></i> Retour √† la liste
              </button>
              <h4 id="category-form-title" style="margin:0;">Nouvelle cat√©gorie</h4>
            </div>
            <form id="category-form">
              <input type="hidden" id="category-edit-mode" value="create" />
              <input type="hidden" id="category-original-name" value="" />
              
              <div class="form-row">
                <label for="category-name">Nom de la cat√©gorie</label>
                <input type="text" id="category-name" name="category" required placeholder="Ex: mobilite" />
                <small style="display:block; margin-top:4px; opacity:0.7;">Utilis√© comme identifiant technique (minuscules, sans espaces)</small>
              </div>

              <div class="form-row">
                <label for="category-icon">Classe d'ic√¥ne FontAwesome</label>
                <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                  <input type="text" id="category-icon" name="icon_class" required placeholder="fa-solid fa-bus" style="flex:1;" />
                  <div id="category-icon-preview" style="width:40px; height:40px; display:flex; align-items:center; justify-content:center; border:1px solid #ddd; border-radius:4px; background:#fff; font-size:20px; transition:all 0.2s;">
                    <i class="fa-solid fa-question" aria-hidden="true"></i>
                  </div>
                  <button type="button" id="category-icon-picker-btn" class="gp-btn gp-btn--secondary" style="white-space:nowrap;">
                    <i class="fa-solid fa-icons"></i> Choisir
                  </button>
                </div>
                <small style="display:block; margin-bottom:8px; opacity:0.7;">
                  Format : <strong>fa-solid fa-nom</strong> ou <strong>fa-regular fa-nom</strong> ‚Ä¢ 
                  <a href="https://fontawesome.com/search?o=r&m=free" target="_blank" rel="noopener" style="color:#1976d2;">üîç Rechercher une ic√¥ne</a>
                </small>
                
                <!-- Icon Picker -->
                <div id="category-icon-picker" style="display:none; padding:12px; border:1px solid #ddd; border-radius:8px; background:#f9f9f9; max-height:300px; overflow-y:auto;">
                  <div style="margin-bottom:8px; font-weight:600; color:#666;">S√©lectionner une ic√¥ne :</div>
                  <div id="category-icon-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(50px, 1fr)); gap:6px;">
                    <!-- Icons will be populated by JS -->
                  </div>
                </div>
              </div>

              <div class="form-row">
                <label for="category-order">Ordre d'affichage</label>
                <input type="number" id="category-order" name="display_order" value="100" min="0" step="1" />
              </div>

              <div class="form-row">
                <label for="category-ville">Ville</label>
                <select id="category-ville" name="ville" required>
                  <option value="">S√©lectionner une ville</option>
                  <!-- Options peupl√©es dynamiquement -->
                </select>
              </div>

              <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="submit" class="gp-btn gp-btn--primary">
                  <i class="fa-solid fa-save"></i> Enregistrer
                </button>
                <button type="button" id="category-form-cancel" class="gp-btn gp-btn--secondary">
                  Annuler
                </button>
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>
  </div>
      <div id="project-detail" class="project-detail">
        <div class="project-detail-header project-header-container">
          <button id="detail-back-btn" class="detail-back-btn">&larr; Retour</button>
           <h3 id="project-title" class="project-title">Titre du Projet</h3>
           <button id="detail-toggle-btn" style="display:none; color:grey;  border:none; cursor:pointer; margin:0 1rem;"><i class="fas fa-chevron-down"></i></button>
           <button id="detail-close-btn" class="detail-close-btn">‚úñ</button>
        </div>
        <div id="detail-content" class="project-detail-content"></div>
      </div>
    </div>

    <!-- Barre de recherche d'adresse -->
    <div id="search-container" class="search-container">
      <button id="info-toggle" class="info-toggle" aria-label="√Ä propos" title="√Ä propos">
        <i class="fas fa-info-circle" aria-hidden="true"></i>
      </button>
      <button id="location-toggle" class="location-toggle" aria-label="Centrer sur ma position" title="Centrer sur ma position"
              onclick="window.GeolocationModule && window.GeolocationModule.handleLocationButtonClick(event)">
        <i class="fas fa-location-arrow"></i>
      </button>
      <!-- City toggle (ouvre une modale) -->
      <button id="city-toggle" class="city-toggle" aria-label="Changer de ville" title="Changer de ville">
        <i class="fas fa-city" aria-hidden="true"></i>
      </button>
      <div id="search-toggle" class="search-toggle">
        <i class="fas fa-search"></i>
      </div>
      <div id="search-overlay" class="search-overlay">
        <div class="search-bar">
          <input type="text" id="address-search" placeholder="Rechercher une adresse..." />
          <div id="search-results" class="search-results"></div>
        </div>
      </div>
    </div>

    <!-- Bouton de s√©lection du fond de carte -->
    <div id="theme-toggle" class="theme-toggle" role="button" tabindex="0" aria-pressed="false" title="Mode sombre">
      <i class="fas fa-moon"></i>
    </div>
    <div id="basemap-toggle" class="basemap-toggle">
      <i class="fas fa-globe"></i>
    </div>
    <!-- Menu des fonds de carte en mode tuile -->
    <div id="basemap-menu" class="basemap-menu"></div>

    <!-- Zone de filtres -->
    <div id="filters-toggle" class="filters-toggle">
      <i class="fas fa-map"></i>
      <span class="filter-count">0</span>
    </div>
    <!-- Contenu des filtres -->
    <div id="filters-container" style="display: none">
      <div id="dynamic-filters"></div>
      <button id="reset-all-filters">R√©initialiser tous les filtres</button>
    </div>
  </div>

  <!-- √Ä propos modal -->
  <div id="about-overlay" class="gp-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="about-title" aria-hidden="true" style="display:none">
    <div class="gp-modal" role="document">
      <div class="gp-modal-header">
        <div class="gp-modal-title" id="about-title">√Ä propos de GrandsProjets.com</div>
        <button class="gp-modal-close" id="about-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="gp-modal-body">
        <div class="about-content">
          <section class="about-text markdown-body">
            <p>Salut üëã Moi c‚Äôest <strong>Solal Gendrin</strong>, Villeurbannais de c≈ìur, passionn√© par la ville et ses transformations.</p>
            <p>J‚Äôai cr√©√© <strong>GrandsProjets.com</strong> pour montrer, sans jargon, ce qui se construit dans la m√©tropole de Lyon.</p>

            <h2>üöß Pourquoi ce site</h2>
            <p>√Ä Lyon, les travaux sont partout : rues bloqu√©es, tramways en chantier, immeubles qui sortent de terre.</p>
            <p>Mais il reste difficile de savoir ce qui est pr√©vu, pourquoi et jusqu‚Äô√† quand.</p>
            <p>Ce site met tout sur une carte : nouvelles lignes de tram, Voies Lyonnaises, r√©am√©nagements de quartiers.</p>
            <p>L‚Äôid√©e est simple : permettre √† chacun de voir rapidement ce qui se passe autour de chez lui.</p>

            <h2>üôã‚Äç‚ôÇÔ∏è Qui je suis</h2>
            <p>Je ne repr√©sente aucune institution.</p>
            <p>Je suis product manager de m√©tier et passionn√© d‚Äôurbanisme.</p>
            <p>J‚Äôai rassembl√© des donn√©es publiques et je les ai organis√©es pour les rendre accessibles √† tous.</p>
          </section>
          <section class="about-sidebar">
            <h2>‚úâÔ∏è Me contacter</h2>
            <p class="about-note">Une remarque, une info, ou juste envie d‚Äô√©changer ?</p>
            <div class="contact-cards">
              <a class="contact-card" href="mailto:solal.gendrin@gmail.com">
                <span class="contact-icon"><i class="fas fa-envelope" aria-hidden="true"></i></span>
                <div class="contact-meta">
                  <div class="contact-title">Email</div>
                  <div class="contact-sub">solal.gendrin@gmail.com</div>
                </div>
              </a>
              <a class="contact-card" href="https://www.linkedin.com/in/solal-gendrin/" target="_blank" rel="noopener">
                <span class="contact-icon"><i class="fab fa-linkedin-in" aria-hidden="true"></i></span>
                <div class="contact-meta">
                  <div class="contact-title">LinkedIn</div>
                  <div class="contact-sub">Solal Gendrin</div>
                </div>
              </a>
            </div>
      </div>
    </div>
  </div>

  <!-- Proposer une ville modal (placed with other overlays) -->
  <div id="propose-city-overlay" class="gp-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="propose-city-title" aria-hidden="true" style="display:none">
    <div class="gp-modal" role="document">
      <div class="gp-modal-header">
        <div class="gp-modal-title" id="propose-city-title">Votre propre carte de projets, √† votre nom</div>
        <button class="gp-modal-close" id="propose-city-close" aria-label="Fermer">&times;</button>
      </div>
      <div class="gp-modal-body">
        <div class="about-content">
          <section class="about-text markdown-body">
            <h2>Qu‚Äôest-ce que c‚Äôest&nbsp;?</h2>
            <p>
              Grandsprojets.com peut √™tre d√©ploy√© en <strong>marque blanche</strong> pour votre structure&nbsp;:
              commune, m√©tropole, association, conseil de quartier, mission locale‚Ä¶
            </p>
            <p>
              Vous obtenez une <strong>carte en ligne √† votre nom</strong>, avec votre logo, int√©gr√©e sur votre site,
              pour pr√©senter vos projets et vos actions.
            </p>
            <p>
              L‚Äôinterface de gestion est simple&nbsp;: <strong>ajouter ou modifier vos projets ne demande aucune comp√©tence technique</strong>.
            </p>
            

            <h2>Pourquoi c‚Äôest utile&nbsp;?</h2>
            <ul>
              <li>Informer clairement vos habitants, adh√©rents ou publics</li>
              <li>Mettre en valeur vos initiatives et leur avancement</li>
              <li>Renforcer l‚Äôimage d‚Äôune structure innovante, transparente et proche de ses publics</li>
            </ul>
            <p><strong>üí∏ Pour les associations, conseils de quartier et missions locales, le service est propos√© gratuitement. J‚Äôaccompagne √©galement b√©n√©volement les structures de terrain dans la mise en place et la duplication.</strong></p>

            <h2>Un projet commun</h2>
            <p>Le code est <strong>open source</strong>, accessible √† tous dans un esprit de transparence.</p>
            
            <h2>Int√©ress√©¬∑e&nbsp;?</h2>
            <p>Envie d‚Äôen discuter et de voir comment l‚Äôadapter √† votre structure&nbsp;?</p>
          </section>
          <section class="about-sidebar">
            <div class="contact-cards">
              <a class="contact-card contact-card--linkedin" href="https://www.linkedin.com/in/solal-gendrin/" target="_blank" rel="noopener">
                <span class="contact-icon"><i class="fab fa-linkedin-in" aria-hidden="true"></i></span>
                <div class="contact-meta">
                  <div class="contact-title">Me contacter sur LinkedIn</div>
                  <div class="contact-sub">Solal Gendrin</div>
                </div>
              </a>
              <a class="contact-card contact-card--email" href="mailto:solal.gendrin@gmail.com">
                <span class="contact-icon"><i class="fas fa-envelope" aria-hidden="true"></i></span>
                <div class="contact-meta">
                  <div class="contact-title">√âcrire un email</div>
                  <div class="contact-sub">solal.gendrin@gmail.com</div>
                </div>
              </a>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase client via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="modules/auth.js"></script>
  <!-- Chargement de Leaflet JS depuis des fichiers locaux -->
  <script src="vendor/leaflet/leaflet.js"></script>
  <!-- Geoman removed: manual drawing only -->
  <!-- Chargement des scripts locaux -->
  
  <!-- Nouveaux modules r√©organis√©s -->
  <script src="modules/analytics.js"></script>
  <script src="modules/modalmanager.js"></script>
  <script src="modules/thememanager.js"></script>
  <script src="modules/citymanager.js"></script>
  <script src="modules/filtermanager.js"></script>
  
  <!-- Modules existants -->
  <script src="modules/supabaseservice.js"></script>
  <script src="modules/mapmodule.js"></script>
  <script src="modules/filtermodule.js"></script>
  <script src="modules/datamodule.js"></script>
  <script src="modules/uimodule.js"></script>
  <script src="modules/searchmodule.js"></script>
  <script src="modules/geolocation.js"></script>
  <script src="modules/submenumodule.js"></script>
  <script src="modules/travauxmodule.js"></script>
  <script src="modules/submenumanager.js"></script>
  <script src="modules/navigationmodule.js"></script>
  <script src="modules/eventbindings.js"></script>
  <script src="modules/contrib.js"></script>
  
  <!-- Main simplifi√© -->
  <script src="main.js"></script>
  <!-- Toast container for accessible notifications -->
  <div id="toast-container" aria-live="polite" aria-atomic="false" role="region" aria-label="Notifications"
       style="position:fixed;right:12px;bottom:12px;display:flex;flex-direction:column;gap:8px;z-index:9999;"></div>
</body>
</html>
