/* ===========================================================================
   COMPONENTS - Composants r√©utilisables
   
   Organisation:
   - Global Scrollbars: Apple-style minimalist scrollbars
   - Filters Container: Filter items, cards, animations (layout in 02-layout.css)
   - Basemap Menu: Tiles, animations, unified with filters
   - Active Filter Tags: Chips and badges
   - Buttons: Apply, reset, etc.
   - Legend Cards: Map legends
   - Project Details: Detail panels
   
   =========================================================================== */

/* ---------------------------------------------------------------------------
   Global Scrollbars - Apple-style Minimalist
   
   Design system:
   - Ultra thin and discrete (6px width)
   - Rounded corners (pill shape)
   - Transparent track
   - Visible on hover only
   - Auto-adapts to light/dark mode via CSS variables
   - Works on Webkit (Chrome, Safari, Edge) and Firefox
--------------------------------------------------------------------------- */

/* Firefox - Thin scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--border-medium) transparent;
}

/* Webkit (Chrome, Safari, Edge) */
*::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

*::-webkit-scrollbar-track {
  background: transparent;
}

*::-webkit-scrollbar-thumb {
  background: transparent;
  border-radius: 10px;
  transition: background 0.2s ease;
}

/* Visible on hover or active scroll */
*:hover::-webkit-scrollbar-thumb,
*:active::-webkit-scrollbar-thumb {
  background: var(--border-medium);
}

*::-webkit-scrollbar-thumb:hover {
  background: var(--gray-400);
}

/* Coins arrondis pour un look Apple */
*::-webkit-scrollbar-corner {
  background: transparent;
}

/* ---------------------------------------------------------------------------
   Filters Container - Icon Grid Design Ultra Clean
   
   Design system:
   - Grid layout 2x2 for filter items
   - Compact cards with icons
   - Transparent active state (primary-alpha-12)
   - Smooth animations and transitions
   - Dark mode compatible with CSS variables
   - Mobile responsive
--------------------------------------------------------------------------- */

/* Grid Container */
#dynamic-filters {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  padding: 4px 0;
}

/* Filter Card */
.filter-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 14px 10px;
  min-height: 95px;
  border-radius: 12px;
  background: var(--surface-base);
  border: 2px solid var(--border-light);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 2px 8px var(--black-alpha-04),
    0 1px 2px var(--black-alpha-04);
}

/* Icon Container */
.filter-icon {
  font-size: 1.875rem;
  margin-bottom: 6px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  z-index: 2;
  color: var(--text-primary);
  opacity: 0.6;
}

/* Label */
.filter-label {
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--text-primary);
  text-align: center;
  transition: all 0.3s ease;
  letter-spacing: 0.01em;
  position: relative;
  z-index: 2;
}

/* Hover State */
.filter-item:hover {
  transform: translateY(-4px) scale(1.02);
  border-color: var(--primary-alpha-3);
  box-shadow: 
    0 12px 24px var(--black-alpha-10),
    0 4px 8px var(--black-alpha-06),
    0 0 0 1px var(--primary-alpha-2);
}

.filter-item:hover .filter-icon {
  transform: scale(1.1) rotate(5deg);
  opacity: 1;
  color: var(--primary);
}

.filter-item:hover .filter-label {
  color: var(--primary);
}

/* Active State - Transparent Primary */
.filter-item.active-filter {
  background: var(--primary-alpha-12);
  border-color: var(--primary);
  box-shadow: 
    0 0 0 2px var(--primary-alpha-2),
    0 8px 20px var(--primary-alpha-15),
    0 4px 8px var(--black-alpha-08);
  animation: filterActivate 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.filter-item.active-filter .filter-icon {
  opacity: 1;
  transform: scale(1.1);
  color: var(--primary);
}

.filter-item.active-filter .filter-label {
  color: var(--primary);
  font-weight: 700;
}

.filter-item.active-filter:hover {
  transform: translateY(-6px) scale(1.03);
  background: var(--primary-alpha-18);
  box-shadow: 
    0 0 0 2px var(--primary-alpha-3),
    0 12px 28px var(--primary-alpha-25),
    0 6px 12px var(--black-alpha-10);
}



/* Animations */
@keyframes filterActivate {
  0% {
    transform: scale(0.95);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.05);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}


/* Mobile Optimizations */
@media (max-width: 640px) {
  #filters-container {
    width: calc(100vw - 40px);
    max-width: 360px;
    right: 20px;
    left: 20px;
    margin: 0 auto;
  }
  
  #dynamic-filters {
    gap: 8px;
  }
  
  .filter-item {
    min-height: 85px;
    padding: 12px 8px;
  }
  
  .filter-icon {
    font-size: 1.625rem;
    margin-bottom: 5px;
  }
  
  .filter-label {
    font-size: 0.75rem;
  }
}

.filter-field {
  padding: 8px 0;
}

.filter-field label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
}

.filter-field input {
  width: 100%;
  padding: 0.5em;
  border: 1px solid var(--gray-300);
  border-radius: 4px;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.filter-field select:focus,
.filter-field input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 5px var(--primary-alpha-5);
  outline: none;
}

/* .reset-filter-btn et .apply-filter-btn utilisent .btn-secondary */

.filter-badge {
  background: var(--gray-50);
  color: var(--primary);
  border-radius: 14px;
  padding: 4px 12px 4px 10px;
  font-size: 0.97em;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: background 0.18s;
}

.filter-badge:hover {
  background: var(--primary-lighter);
}

.active-filter-tag {
  background: var(--surface-base);
  display: inline-flex;
  align-items: center;
  color: var(--gray-700);
  padding: 0.4em 0.8em;
  border-radius: 4px;
  font-size: 0.85rem;
  font-weight: 600;
  box-shadow: 0 2px 4px var(--black-alpha-10);
  margin-right: 8px;
  margin-bottom: 8px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.active-filter-tag:hover {
  box-shadow: 0 4px 6px var(--black-alpha-15);
}

/* .active-filter-tag .close-btn utilise .btn-secondary .btn-small */

#reset-all-filters {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid transparent;
  background-color: transparent;
  display: inline-block;
  margin: auto;
  color: var(--gray-400);
}

#reset-all-filters:hover {
  box-shadow: 0 4px 6px var(--black-alpha-10), 0 1px 3px var(--black-alpha-08);
  border: 1px solid var(--danger);
  color: var(--white);
  background-color: var(--danger);
}

/* ---------------------------------------------------------------------------
   Travaux filters
--------------------------------------------------------------------------- */
.travaux-checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 0.9rem;
  color: var(--gray-700);
  margin: 0.5rem 0;
  user-select: none;
}

.travaux-checkbox {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.travaux-checkbox-custom {
  position: relative;
  display: inline-block;
  width: 18px;
  height: 18px;
  background-color: var(--surface-base);
  border: 2px solid var(--primary);
  border-radius: 4px;
  margin-right: 10px;
  flex-shrink: 0;
  transition: all 0.2s ease;
}

.travaux-checkbox:checked ~ .travaux-checkbox-custom {
  background-color: var(--primary);
}

.travaux-checkbox:checked ~ .travaux-checkbox-custom::after {
  content: "‚úì";
  position: absolute;
  color: var(--white);
  font-size: 12px;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}

.travaux-checkbox:focus ~ .travaux-checkbox-custom {
  box-shadow: 0 0 0 2px var(--primary-alpha-3);
}

.travaux-checkbox-label:hover .travaux-checkbox-custom {
  border-color: var(--primary-hover);
}

.travaux-checkbox:checked:hover ~ .travaux-checkbox-custom {
  background-color: var(--primary-hover);
  border-color: var(--primary-hover);
}

.travaux-filters-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.gpv2-filter-badge {
  background: var(--gray-100);
  border-radius: 999px;
  padding: 0.4rem 0.8rem;
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.9rem;
}

.gpv2-filter-badge i {
  color: var(--danger);
}

.travaux-reset-btn {
  background: var(--danger);
  color: var(--white);
  border: none;
  border-radius: 4px;
  padding: 0.6rem 1rem;
  width: 100%;
  transition: background 0.2s;
}

.travaux-reset-btn:hover {
  background: var(--danger);
}

/* ============================================================================
   FILTRES TRAVAUX - Design ultra-clean
============================================================================ */

#travaux-filters-ux {
  padding: 20px;
}

/* Card Ajouter */
.travaux-add-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  margin-bottom: 20px;
  background: var(--surface-base);
  border: 1px solid var(--border-light);
  border-radius: 8px;
}

.add-card-label {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--text-primary);
}

.add-card-btn {
  padding: 8px 12px;
}

/* Header */
.filters-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.filters-title {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
}

.filters-count {
  padding: 2px 8px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--text-secondary);
  background: var(--surface-elevated);
  border-radius: 10px;
}

/* Tags actifs */
.filters-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 16px;
}

.filters-tags:empty {
  display: none;
}

.gpv2-filter-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  font-size: 0.8125rem;
  color: var(--primary);
  background: var(--primary-alpha-12);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.gpv2-filter-badge:hover {
  background: var(--primary-alpha-20);
}

.gpv2-filter-badge i {
  font-size: 0.75rem;
  opacity: 0.8;
}

/* Formulaire */
.filters-form {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Switch (exclure r√©seaux) */
.filter-switch {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--surface-elevated);
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
}

.filter-switch input {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.switch-slider {
  position: relative;
  width: 40px;
  height: 22px;
  background: var(--border-medium);
  border-radius: 11px;
  transition: background 0.2s;
}

.switch-slider::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 18px;
  height: 18px;
  background: var(--white);
  border-radius: 50%;
  transition: transform 0.2s;
}

.filter-switch input:checked ~ .switch-slider {
  background: var(--primary);
}

.filter-switch input:checked ~ .switch-slider::after {
  transform: translateX(18px);
}

.switch-label {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--text-primary);
}

/* Groupes de champs */
.filter-group {
  display: flex;
  flex-direction: column;
  align-items: normal !important;
  gap: 6px;
}

.filter-group label {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 6px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.filter-group label i {
  font-size: 0.875rem;
  color: var(--primary);
}

.filter-group select,
.filter-group input[type="date"] {
  font-size: 0.9375rem;
  color: var(--text-primary);
  background: var(--surface-base);
  border: 1px solid var(--border-medium);
  border-radius: 6px;
  transition: all 0.2s;
  
  width: auto;
  padding: 12px;
}


.filter-group select:focus,
.filter-group input[type="date"]:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-alpha-15);
}

.filter-group input[type="date"]::-webkit-calendar-picker-indicator {
  cursor: pointer;
  filter: invert(0.5);
}

.filter-group input[type="date"]::-webkit-calendar-picker-indicator:hover {
  filter: invert(0.3);
}



/* Bouton reset */
.filters-form button[type="button"] {
  margin-top: 8px;
}


/* ---------------------------------------------------------------------------
   Badges, Chips & Pills
--------------------------------------------------------------------------- */
.chip {
  display: inline-flex;
  align-items: center;
  gap: 0.4em;
  background: linear-gradient(135deg, var(--surface-base), var(--surface-base));
  color: var(--gray-700);
  border-radius: 8px;
  font-size: 0.9em;
  font-weight: 600;
  padding: 0.24em 0.8em 0.24em 0.7em;
  box-shadow: 0 6px 12px var(--black-alpha-06);
  border: 1.2px solid var(--gray-200);
  transition: background 0.18s, box-shadow 0.18s;
  letter-spacing: 0.01em;
}

.chip-route::before {
  content: 'üó∫Ô∏è';
  margin-right: 0.3em;
}

.chip-trafic::before {
  content: 'üö¶';
  margin-right: 0.3em;
}

.project-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 10px 12px;
  margin: 0;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  background: var(--black-alpha-06);
  color: var(--gray-900);
  font-size: 0.85rem;
  border: 1px solid var(--black-alpha-08);
}

.badge-strong {
  background: var(--primary-alpha-12);
  color: var(--primary);
  border-color: var(--primary-alpha-25);
}

.etat-pill {
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 0.85rem;
  border: 1px solid transparent;
}

.etat-pill.etat--ouvert {
  color: var(--primary);
  background: var(--primary-alpha-12);
  border-color: var(--primary-alpha-35);
}

.etat-pill.etat--prochain {
  color: var(--warning);
  background: var(--warning-alpha-14);
  border-color: var(--warning-alpha-35);
}

.etat-pill.etat--termine {
  color: var(--gray-600);
  background: var(--gray-600);
  border-color: var(--gray-600);
}

.etat-pill.etat--neutre {
  color: var(--gray-700);
  background: var(--gray-400);
  border-color: var(--gray-400);
}

.etat-line {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--gray-900);
}

.etat-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  display: inline-block;
}

.etat-dot.etat--ouvert {
  background: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-alpha-2);
}

.etat-dot.etat--prochain {
  background: var(--warning);
  box-shadow: 0 0 0 3px var(--warning-alpha-25);
}

.etat-dot.etat--termine {
  background: var(--gray-600);
  box-shadow: 0 0 0 3px var(--gray-600);
}

.etat-dot.etat--neutre {
  background: var(--gray-400);
  box-shadow: 0 0 0 3px var(--gray-400);
}

.badges {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

/* ---------------------------------------------------------------------------
   Covers & Images
--------------------------------------------------------------------------- */
.project-cover {
  width: 100%;
  max-width: 100%;
  margin-bottom: 0px;
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 6px 24px var(--primary-alpha-11);
}

.project-cover img,
.project-cover {
  width: 100%;
  height: 360px;
  object-fit: cover;
  border-radius: 12px;
  display: block;
}

.project-description {
  margin-top: 20px !important;
  line-height: 1.4em;
}

/* ---------------------------------------------------------------------------
   Project Cover Wrap - Utilis√© dans navigationmodule.js
--------------------------------------------------------------------------- */
.project-cover-wrap {
  position: relative;
  display: block;
  width: 100%;
  max-height: 420px;
  overflow: visible;
}

.project-cover {
  display: block;
  width: 100%;
  height: 360px;
  max-height: 420px;
  object-fit: cover;
  border-radius: 12px;
}

.cover-extend-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.95);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  opacity: 0;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px var(--black-alpha-10);
}

.cover-extend-btn i {
  color: var(--gray-700);
  font-size: 0.875rem;
}

.project-cover-wrap:hover .cover-extend-btn {
  opacity: 1;
}
.cover-extend-btn {
  background: var(--white);
}
.cover-extend-btn:hover {
  box-shadow: 0 4px 12px var(--black-alpha-12);
  transform: translateY(-1px);
}

.cover-extend-btn:active {
  transform: translateY(0);
}

/* Cover lightbox reste utilis√© */
.cover-lightbox {
  position: fixed;
  inset: 0;
  z-index: 3000;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--black-alpha-40);
  backdrop-filter: blur(10px) saturate(120%);
  -webkit-backdrop-filter: blur(10px) saturate(120%);
  animation: lb-fade .15s ease-out;
}

.cover-lightbox .lightbox-content {
  position: relative;
  max-width: 92vw;
  max-height: 92vh;
}

.cover-lightbox img {
  max-width: 92vw;
  max-height: 92vh;
  width: auto;
  height: auto;
  border-radius: 12px;
  box-shadow: 0 12px 40px var(--black-alpha-35);
}

/* .lightbox-close utilise .btn-secondary */
.cover-lightbox .lightbox-close {
  position: absolute;
  top: -14px;
  right: -14px;
}

@keyframes lb-fade {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ---------------------------------------------------------------------------
   Boutons CTA "Voir la fiche compl√®te"
--------------------------------------------------------------------------- */
.detail-fullpage-btn {
  display: inline-flex;
  width: calc(100% - 44px);
  align-items: center;
  justify-content: center;
  gap: 10px;
  position: relative;
  background: var(--color-primary);
  background-size: 220% 220%;
  color: var(--white);
  border: 1px solid var(--white-alpha-28);
  padding: 12px 22px;
  border-radius: 999px;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  text-decoration: none;
  transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease, background-position 0.6s ease;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15), 0 2px 6px var(--black-alpha-08), inset 0 1px 0 var(--white-alpha-35);
  text-align: center;
  margin: 12px 20px;
  box-sizing: border-box;
  text-shadow: 0 1px 0 var(--black-alpha-15);
  animation: ctaIntro 520ms cubic-bezier(0.16, 1, 0.3, 1) 1 both, ctaGradient 7s ease-in-out infinite, ctaPulse 5s ease-in-out infinite;
  overflow: hidden;
  contain: paint;
  max-width: 100%;
  will-change: transform;
}

.detail-fullpage-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(120px 40px at -10% 50%, var(--white-alpha-35), transparent 60%), linear-gradient(to right, transparent, var(--white-alpha-25), transparent);
  transform: translateX(-130%);
  animation: ctaSheen 3.5s ease-in-out infinite;
  pointer-events: none;
}

.detail-fullpage-btn:hover {
  transform: translateY(-2px) scale(1.02);
  background-position: 90% 10%;
  box-shadow: 0 14px 30px rgba(0, 0, 0, 0.2), 0 4px 10px var(--black-alpha-10), inset 0 1px 0 var(--white-alpha-40);
}

.detail-fullpage-btn:active {
  transform: translateY(0) scale(0.99);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15), 0 2px 6px var(--black-alpha-08);
}

.detail-fullpage-btn:focus-visible {
  outline: 3px solid rgba(0, 0, 0, 0.3);
  outline-offset: 3px;
}

.detail-fullpage-btn i {
  transition: transform 0.2s ease;
}

.detail-fullpage-btn:hover i {
  transform: translateX(2px);
}

@keyframes ctaGradient {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes ctaSheen {
  0% {
    transform: translateX(-130%);
  }
  60% {
    transform: translateX(130%);
  }
  100% {
    transform: translateX(130%);
  }
}

@keyframes ctaPulse {
  0%,
  100% {
    filter: brightness(1);
    box-shadow: 0 10px 24px var(--primary-alpha-35), 0 2px 6px var(--black-alpha-08);
  }
  50% {
    filter: brightness(1.05);
    box-shadow: 0 16px 34px var(--primary-alpha-45), 0 4px 12px var(--black-alpha-10);
  }
}

@keyframes ctaIntro {
  0% {
    opacity: 0;
    transform: translateY(8px) scale(0.985);
    filter: saturate(0.9);
  }
  60% {
    opacity: 1;
    transform: translateY(0) scale(1.005);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: saturate(1);
  }
}

#detail-fullpage-btn {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: var(--primary);
  color: var(--white);
  border: none;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  text-decoration: none;
  font-size: 0.9rem;
  white-space: nowrap;
  box-shadow: 0 2px 10px var(--black-alpha-20);
  z-index: 1001;
  display: flex;
  align-items: center;
  gap: 8px;
}

#detail-fullpage-btn:hover {
  background-color: var(--primary);
}

/* ---------------------------------------------------------------------------
   Legend card for Travaux progress
--------------------------------------------------------------------------- */
.legend-card {
  display: block;
  background: var(--surface-base);
  color: var(--text-primary);
  border: 1px solid var(--border-medium);
  border-radius: 14px;
  padding: 12px 14px;
  box-shadow: 0 4px 14px var(--black-alpha-06);
}

.legend-card .legend-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  margin-bottom: 10px;
}

.legend-card .legend-header i {
  color: var(--text-primary);
  opacity: 0.8;
}

.legend-card .legend-title {
  font-size: 0.95rem;
}

.legend-card .legend-gradient {
  height: 12px;
  border-radius: 999px;
  border: 1px solid var(--border-medium);
  background: linear-gradient(90deg,
    var(--danger) 0%,
    var(--danger) 10%,
    var(--danger) 20%,
    var(--warning) 30%,
    var(--warning) 40%,
    var(--warning) 50%,
    var(--warning) 60%,
    var(--primary) 70%,
    var(--primary) 85%,
    var(--primary) 100%
  );
}

.legend-card .legend-scale {
  display: flex;
  justify-content: space-between;
  font-size: 0.82rem;
  opacity: 0.8;
  margin-top: 6px;
}

/* ---------------------------------------------------------------------------
   Basemap Menu - Unified with Filters Container
   
   Design system:
   - Same glassmorphism effect (blur + saturation)
   - Same border-radius (20px)
   - Same header with title
   - Same close button style
   - Same card/tile style with transparent active state
   - Same animations and transitions
   - Same dark mode compatibility
--------------------------------------------------------------------------- */

/* Container */
.basemap-menu {
  position: absolute;
  top: 70px;
  right: 20px;
  left: auto;
  width: 340px;
  max-height: 70vh;
  background: linear-gradient(145deg, var(--white-alpha-95) 0%, var(--white-alpha-90) 100%);
  backdrop-filter: blur(24px) saturate(180%);
  border: 1px solid var(--white-alpha-50);
  border-radius: 20px;
  padding: 60px 16px 16px 16px;
  box-shadow: 
    0 20px 60px var(--black-alpha-15),
    0 8px 16px var(--black-alpha-08),
    inset 0 1px 0 var(--white-alpha-80);
  z-index: 1000;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  display: none;
  overflow-y: auto;
  animation: basemapSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.basemap-menu.open {
  display: grid;
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

@keyframes basemapSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Header title */
.basemap-menu::before {
  content: 'Fonds de carte';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  padding: 18px 20px;
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--text-primary);
  border-bottom: 1px solid var(--border-light);
  letter-spacing: 0.02em;
  text-align: center;
  background: linear-gradient(180deg, var(--white-alpha-80) 0%, transparent 100%);
  border-radius: 20px 20px 0 0;
}

/* .basemap-close-btn utilise .btn-secondary */
.basemap-close-btn {
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 10;
}

.basemap-tile {
  min-height: 85px;
  padding: 14px 10px;
  border: 2px solid var(--border-light);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  background: var(--surface-base);
  font-weight: 600;
  color: var(--text-primary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.75rem;
  line-height: 1.3;
  text-align: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: visible;
  box-shadow: 
    0 2px 8px var(--black-alpha-04),
    0 1px 2px var(--black-alpha-04);
}

/* Progress Bar Container - Cach√© par d√©faut */
.basemap-tile::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gray-400);
  border-radius: 0 0 10px 10px;
  z-index: 10;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;
}

/* Progress Bar Fill - Cach√© par d√©faut */
.basemap-progress {
  position: absolute;
  bottom: -2px;
  left: 0;
  height: 4px;
  background: linear-gradient(90deg, 
    var(--primary) 0%, 
    var(--primary-hover) 100%
  );
  width: 0;
  border-radius: 0 0 10px 10px;
  box-shadow: 
    0 0 20px var(--primary),
    0 0 40px var(--primary-alpha-55),
    0 2px 12px var(--primary-alpha-50),
    0 0 6px var(--primary);
  z-index: 11;
  pointer-events: none;
  transition: none;
  will-change: width;
  opacity: 0;
}

/* Afficher la barre uniquement pendant le survol (is-hovering) */
.basemap-tile.is-hovering::after {
  opacity: 1;
}

.basemap-tile.is-hovering .basemap-progress {
  opacity: 1;
  width: 100% !important;
  transition: width 1s linear !important;
}

/* Cacher pour les tiles actives */
.basemap-tile.active-basemap::after,
.basemap-tile.active-basemap .basemap-progress {
  opacity: 0 !important;
  display: none;
}

/* Reset apr√®s mouseleave */
.basemap-tile:not(.is-hovering) .basemap-progress {
  width: 0 !important;
  transition: width 0.15s ease-out !important;
  opacity: 0;
}

.basemap-tile:not(.is-hovering)::after {
  opacity: 0;
}

.basemap-tile:hover {
  transform: translateY(-4px) scale(1.02);
  border-color: var(--primary-alpha-3);
  box-shadow: 
    0 12px 24px var(--black-alpha-10),
    0 4px 8px var(--black-alpha-06),
    0 0 0 1px var(--primary-alpha-2);
  color: var(--primary);
}

/* Glow effect during hover - plus visible */
.basemap-tile.is-hovering {
  transform: translateY(-4px) scale(1.02);
  border-color: var(--primary);
  color: var(--primary);
  animation: basemapGlow 1s ease-in-out infinite, basemapBackgroundPulse 1s ease-in-out infinite;
}

@keyframes basemapGlow {
  0%, 100% {
    box-shadow: 
      0 12px 24px var(--black-alpha-10),
      0 4px 8px var(--black-alpha-06),
      0 0 0 2px var(--primary-alpha-25),
      0 0 16px var(--primary-alpha-25);
  }
  50% {
    box-shadow: 
      0 16px 32px var(--black-alpha-15),
      0 8px 16px var(--black-alpha-10),
      0 0 0 2px var(--primary-alpha-35),
      0 0 32px var(--primary-alpha-45);
  }
}

/* Background pulse avec couleur primaire */
@keyframes basemapBackgroundPulse {
  0%, 100% {
    background: var(--surface-base);
  }
  50% {
    background: linear-gradient(135deg, 
      var(--primary-alpha-10) 0%, 
      var(--surface-base) 50%, 
      var(--primary-alpha-10) 100%
    );
  }
}

.basemap-tile.active-basemap {
  background: var(--primary-alpha-12);
  color: var(--primary);
  border-color: var(--primary);
  font-weight: 700;
  box-shadow: 
    0 0 0 2px var(--primary-alpha-2),
    0 8px 20px var(--primary-alpha-15),
    0 4px 8px var(--black-alpha-08);
  animation: basemapActivate 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes basemapActivate {
  0% {
    transform: scale(0.95);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.05);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Mobile Optimizations for basemap menu */
@media (max-width: 640px) {
  .basemap-menu {
    width: calc(100vw - 40px);
    max-width: 340px;
    right: 20px;
    left: auto;
    margin: 0;
  }
  
  .basemap-tile {
    min-height: 75px;
    padding: 12px 8px;
    font-size: 0.65rem;
  }
  
  /* Progress bar plus visible sur mobile */
  .basemap-progress {
    height: 5px;
    bottom: -5px;
    box-shadow: 
      0 0 30px var(--primary),
      0 0 50px var(--primary-alpha-55),
      0 3px 15px var(--primary-alpha-50),
      0 0 8px var(--primary);
  }
  
  .basemap-tile::after {
    height: 5px;
    bottom: -3px;
  }
}

/* ---------------------------------------------------------------------------
   CITY MENU - S√©lecteur d'espace
   M√™me design que basemap-menu, positionn√© sous le toggle
--------------------------------------------------------------------------- */

.city-menu {
  position: fixed;
  /* Position : en haut √† droite, sous les toggles */
  top: 68px;
  right: 12px;
  left: auto;
  width: 280px;
  max-height: calc(100vh - 100px);
  background: linear-gradient(145deg, var(--white-alpha-95) 0%, var(--white-alpha-90) 100%);
  backdrop-filter: blur(24px) saturate(180%);
  border: 1px solid var(--white-alpha-50);
  border-radius: 20px;
  padding: 16px;
  box-shadow: 
    0 20px 60px var(--black-alpha-15),
    0 8px 16px var(--black-alpha-08),
    inset 0 1px 0 var(--white-alpha-80);
  z-index: 1000;
  display: none;
  flex-direction: column;
  gap: 8px;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  overflow-y: auto;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.city-menu.active {
  display: flex;
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  animation: cityMenuSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes cityMenuSlideIn {
  from {
    opacity: 0;
    transform: translateY(-10px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.city-menu-empty {
  padding: 20px;
  text-align: center;
  color: var(--text-secondary);
  font-size: 0.875rem;
}

.city-menu-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  background: var(--surface-base);
  border: 2px solid var(--border-light);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  width: 100%;
  text-align: left;
}

.city-menu-item:hover {
  background: var(--surface-hover);
  border-color: var(--primary-alpha-30);
  transform: translateX(4px);
}

.city-menu-item.is-active {
  background: var(--primary-alpha-08);
  border-color: var(--primary);
}

.city-menu-icon {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.city-menu-icon img,
.city-menu-logo {
  width: 32px;
  height: 32px;
  object-fit: contain;
  border-radius: 6px;
}

.city-menu-icon i {
  font-size: 1.25rem;
  color: var(--text-secondary);
}

.city-menu-name {
  flex: 1;
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--text-primary);
}

.city-menu-check {
  color: var(--primary);
  font-size: 0.875rem;
}

/* Dark mode */
[data-theme="dark"] .city-menu {
  background: linear-gradient(145deg, var(--gray-800-alpha-95) 0%, var(--gray-900-alpha-90) 100%);
  border-color: var(--white-alpha-10);
}

/* Mobile - Juste ajuster la largeur max */
@media (max-width: 720px) {
  .city-menu {
    max-width: calc(100vw - 24px);
  }
}

/* ---------------------------------------------------------------------------
   Project detail styles
--------------------------------------------------------------------------- */
.project-detail {
  display: none;
  background-color: var(--white-alpha-80);
  backdrop-filter: blur(10px);
}

/* Les boutons utilisent le syst√®me gp-button-system.css */

.project-detail .pill {
  background: var(--gray-100);
  padding: 4px 8px;
  border-radius: 8px;
  margin-right: 8px;
  font-size: 0.9rem;
  font-weight: bold;
  color: var(--gray-600);
}

.project-detail .pill.green {
  background: var(--primary);
  color: var(--white);
}

.project-detail .pill-outline {
  background: none;
  border: 2px solid var(--primary);
  color: var(--primary);
  border-radius: 8px;
  padding: 2px 8px;
  margin-left: auto;
  font-size: 0.9rem;
  cursor: pointer;
}

.project-detail h3 {
  margin-top: 0;
}

.project-detail p {
  margin-bottom: 1rem;
  line-height: 1.4;
}

.project-detail img {
  max-width: 100%;
  border-radius: 5px;
  margin: 1rem 0;
}

.project-detail img:hover {
  box-shadow: 0 2px 8px var(--black-alpha-15);
  transform: scale(1.02);
}
