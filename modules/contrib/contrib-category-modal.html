<!-- Category Form Modal -->
<div id="category-modal-overlay" class="gp-modal-overlay gp-modal--glass" role="dialog" aria-modal="true" aria-labelledby="category-modal-title" aria-hidden="true">
  <div class="gp-modal gp-modal--large" role="document">
    <header class="gp-modal-header">
      <h1 class="gp-modal-title" id="category-modal-title">Nouvelle catégorie</h1>
      <button class="btn-secondary gp-modal-close" id="category-modal-close" aria-label="Fermer">&times;</button>
    </header>
    <div class="gp-modal-body">
      <form id="category-form">
        <input type="hidden" id="category-edit-mode" value="create" />
        <input type="hidden" id="category-original-name" value="" />
        
        <!-- Section: Informations de base -->
        <div class="gp-form-section">
          <h4 class="gp-form-section-title">
            <i class="fa-solid fa-circle-info"></i>
            Informations de base
          </h4>
          
          <div class="gp-form-card">
            <!-- Nom + Ordre sur la même ligne -->
            <div class="gp-flex gp-flex-gap-12" style="align-items:start;">
              <div class="gp-flex-1">
                <label for="category-name" class="gp-form-label">Nom de la catégorie</label>
                <input type="text" id="category-name" name="category" required placeholder="Ex: mobilite" class="gp-form-input" />
                <small class="gp-form-hint">
                  <i class="fa-solid fa-lightbulb" style="color:var(--warning);"></i> Identifiant technique
                </small>
              </div>
              <div style="min-width:120px;">
                <label for="category-order" class="gp-form-label">Ordre</label>
                <input type="number" id="category-order" name="display_order" value="100" min="0" step="1" class="gp-form-input" />
              </div>
            </div>
          </div>
          
          <div class="gp-form-card">
            <!-- Icône -->
            <label for="category-icon" class="gp-form-label">Icône</label>
            <div class="gp-flex gp-flex-gap-12 gp-flex-center">
              <input type="text" id="category-icon" name="icon_class" required placeholder="fa-solid fa-bus" class="gp-form-input gp-form-input-mono gp-flex-1" />
              <div id="category-icon-preview" class="gp-icon-preview">
                <i class="fa-solid fa-question" aria-hidden="true"></i>
              </div>
              <button type="button" id="category-icon-picker-btn" class="btn-secondary" style="white-space:nowrap;">
                <i class="fa-solid fa-icons"></i> Choisir
              </button>
            </div>
            <small class="gp-form-hint">
              <a href="https://fontawesome.com/search?o=r&m=free" target="_blank" rel="noopener">
                <i class="fa-solid fa-arrow-up-right-from-square"></i> Parcourir les icônes FontAwesome
              </a>
            </small>
            
            <!-- Icon Picker moderne -->
            <div id="category-icon-picker" class="gp-icon-picker">
              <div class="gp-icon-picker-title">
                <i class="fa-solid fa-grid-2"></i> Sélectionner une icône
              </div>
              <div id="category-icon-grid" class="gp-icon-grid">
                <!-- Icons populated by JS -->
              </div>
            </div>
          </div>
          
          <!-- Champ ville caché mais toujours présent pour le JS -->
          <input type="hidden" id="category-ville" name="ville" value="" />
        </div>

        <!-- Section: Style de rendu -->
        <div class="gp-form-section">
          <h4 class="gp-form-section-title">
            <i class="fa-solid fa-palette"></i>
            Style de rendu sur la carte
          </h4>
          
          <!-- Prévisualisation -->
          <div class="gp-form-card gp-style-preview">
            <div class="gp-form-label" style="margin-bottom:16px;">Aperçu</div>
            <svg width="200" height="120">
              <line id="style-preview-line" x1="20" y1="30" x2="180" y2="30" stroke="var(--black)" stroke-width="3" />
              <polygon id="style-preview-polygon" points="20,60 100,90 180,60 180,100 20,100" stroke="var(--black)" stroke-width="3" fill="var(--gray-400)" fill-opacity="0.3" />
            </svg>
          </div>
          
          <!-- Paramètres de style -->
          <div class="gp-form-card">
            <div class="gp-grid-2">
              <div>
                <label for="category-style-color" class="gp-form-label">Couleur de trait</label>
                <input type="color" id="category-style-color" value="#000000" class="gp-form-color">
              </div>
              <div>
                <label for="category-style-weight" class="gp-form-label">Épaisseur</label>
                <input type="number" id="category-style-weight" min="1" max="10" placeholder="3" class="gp-form-input">
              </div>
            </div>
            
            <div class="gp-grid-2" style="margin-top:16px;">
              <div>
                <label for="category-style-dasharray" class="gp-form-label">Pointillés</label>
                <input type="text" id="category-style-dasharray" placeholder="Ex: 5,10" class="gp-form-input">
              </div>
              <div>
                <label for="category-style-opacity" class="gp-form-label">Opacité</label>
                <input type="number" id="category-style-opacity" min="0" max="1" step="0.1" placeholder="1" class="gp-form-input">
              </div>
            </div>
            
            <!-- Remplissage -->
            <div style="margin-top:24px; padding-top:24px; border-top:1px solid var(--border-light, var(--gray-200));">
              <label class="gp-checkbox-label">
                <input type="checkbox" id="category-style-fill">
                <span>Activer le remplissage pour les polygones</span>
              </label>
              
              <div id="category-style-fill-options" class="gp-fill-options">
                <div class="gp-grid-2">
                  <div>
                    <label for="category-style-fillcolor" class="gp-form-label">Couleur de remplissage</label>
                    <input type="color" id="category-style-fillcolor" value="#9CA3AF" class="gp-form-color">
                  </div>
                  <div>
                    <label for="category-style-fillopacity" class="gp-form-label">Opacité du remplissage</label>
                    <input type="number" id="category-style-fillopacity" min="0" max="1" step="0.1" placeholder="0.3" class="gp-form-input">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Tags disponibles -->
        <div class="gp-form-section">
          <h4 class="gp-form-section-title">
            <i class="fa-solid fa-tags"></i>
            Tags disponibles
          </h4>
          
          <!-- Liste des tags existants -->
          <div class="gp-form-card">
            <div class="gp-form-label" style="margin-bottom:12px;">
              <i class="fa-solid fa-list"></i> Tags existants
            </div>
            <div id="category-tags-list" style="display:flex; flex-wrap:wrap; gap:8px; min-height:40px;">
              <!-- Tags injectés dynamiquement par JavaScript -->
            </div>
          </div>
          
          <!-- Formulaire d'ajout/modification -->
          <div class="gp-dashed-card">
            <div class="gp-form-label" style="margin-bottom:12px;">
              <i class="fa-solid fa-plus"></i> Ajouter un tag
            </div>
            
            <!-- Message d'édition (masqué par défaut) -->
            <div id="category-tag-edit-message" class="gp-edit-alert">
              <i class="fa-solid fa-triangle-exclamation"></i> Vous modifiez un tag existant
            </div>
            
            <div>
              <label for="category-tag-name" class="gp-form-label">Nom du tag</label>
              <input type="text" id="category-tag-name" placeholder="Ex: Piste cyclable" class="gp-form-input">
            </div>
            
            <div class="gp-flex gp-flex-gap-12" style="margin-top:12px;">
              <div class="gp-flex-1">
                <label for="category-tag-icon" class="gp-form-label">Icône FontAwesome</label>
                <input type="text" id="category-tag-icon" placeholder="fa-tag" value="fa-tag" class="gp-form-input gp-form-input-mono">
              </div>
              <div>
                <label for="category-tag-color" class="gp-form-label">Couleur</label>
                <input type="color" id="category-tag-color" value="#3B82F6" class="gp-form-color" style="height:40px;">
              </div>
            </div>
            
            <div class="gp-flex gp-flex-gap-8" style="margin-top:12px;">
              <button type="button" id="category-add-tag-btn" class="btn-primary gp-flex-1">
                <i class="fa-solid fa-plus"></i> <span id="category-add-tag-btn-text">Ajouter le tag</span>
              </button>
              <button type="button" id="category-cancel-tag-btn" class="btn-secondary" style="display:none;">
                <i class="fa-solid fa-xmark"></i> Annuler
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
    <footer class="gp-modal-footer">
      <div class="gp-modal-footer-left">
        <button type="button" id="category-modal-cancel" class="btn-secondary">
          Annuler
        </button>
      </div>
      <div class="gp-modal-footer-right">
        <button type="submit" form="category-form" class="btn-primary">
          <i class="fa-solid fa-check"></i>
          <span>Enregistrer</span>
        </button>
      </div>
    </footer>
  </div>
</div>
